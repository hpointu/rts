{"version":3,"sources":["hpointu/rts/app.cljs"],"mappings":"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","names":["hpointu.rts.app/current-time","cljs.core.atom","js/hpointu","js/hpointu.rts","js/hpointu.rts.app","js/hpointu.rts.app.state","hpointu.rts.app/state","hpointu.rts.app/SIZE","hpointu.rts.app/init-state","hpointu.rts.core/->world","p__33698","vec__33699","cljs.core.nth","hpointu.rts.app/to-screen","x","y","p__33702","vec__33703","hpointu.rts.app/to-world","hpointu.rts.app/get-canvas","js/document.getElementById","hpointu.rts.app/draw-tile!","ctx","world","size","hover?","vec__33706","tile-color","hpointu.rts.app/obstacle?","hpointu.rts.graphics/render-item!","p__33709","map__33710","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","hpointu.rts.app/draw-map!","hover","state","seq__33712","cljs.core/seq","chunk__33717","count__33718","i__33719","seq__33720","chunk__33721","count__33722","i__33723","temp__5735__auto__","cljs.core/chunked-seq?","c__4556__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","seq__33713","chunk__33714","count__33715","i__33716","cljs.core.range","hpointu.rts.app/world-width","hpointu.rts.app/world-height","cljs.core._EQ_","hpointu.rts.app/update-state","dt","canvas","cljs.core.assoc","cljs.core.into","cljs.core.map","cljs.core/int","hpointu.rts.input/mouse-pos","hpointu.rts.app/draw!","hpointu.rts.app/tick!","t","js/Date","cljs.core/deref","new-state","cljs.core/reset!","hpointu.rts.app/stop","cljs.core.println","hpointu.rts.app/start","hpointu.rts.app/init","js/setInterval","hpointu.rts.input/init!"],"sourcesContent":["(ns hpointu.rts.app\n  (:require [hpointu.rts.graphics :as g]\n            [hpointu.rts.input :as io]\n            [hpointu.rts.core :as core]))\n\n(def current-time (atom 0))\n(defonce state (atom {}))\n\n(def SIZE 35)\n(defn init-state []\n  {:world (core/->world 15 10)})\n\n(defn to-screen [[x y]]\n  [(* SIZE x) (* SIZE y)])\n\n(defn to-world [[x y]]\n  [(/ x SIZE) (/ y SIZE)])\n\n(defn get-canvas []\n  (js/document.getElementById \"game\"))\n\n(defn draw-tile! [ctx world x y size hover?]\n  (let [tile-color (if (obstacle? world x y) \"gray\" (if hover? \"green\" \"#222\"))\n        [x y] (to-screen [x y])]\n    (g/render-item! ctx {:type :rect :x (+ 1 x) :y (+ 1 y)\n                         :w (- size 2) :h (- size 2) :fill tile-color})\n    (g/render-item! ctx {:type :rect :x (+ 2 x) :y (+ 2 y)\n                         :w (- size 4) :h (- size 4) :fill \"black\"})))\n\n(defn draw-map! [ctx {:keys [world hover] :as state}]\n  (doseq [x (range (world-width world))\n          y (range (world-height world))]\n    (draw-tile! ctx world x y SIZE (= hover [x y])))) \n\n(defn update-state [state dt] state\n  (let [canvas (get-canvas)]\n    (assoc state :hover (into [] (map int (to-world (io/mouse-pos canvas)))))))\n \n(defn draw! [state]\n  (let [canvas (get-canvas)\n        ctx (. canvas getContext \"2d\")]\n    (.clearRect ctx 0 0 (.-width canvas) (.-height canvas))\n    (draw-map! ctx state)))\n\n(defn tick! []\n  (let [t (.now js/Date)\n        dt (- t @current-time)\n        new-state (update-state @state dt)]\n    (do (reset! current-time t)\n        (draw! new-state)\n        (reset! state new-state))))\n\n(defn ^:dev/before-load stop []\n  (println \"Stopping...\"))\n\n(defn ^:dev/after-load start []\n  (println (str \"Starting...\")))\n\n(defn ^:export init []\n  (println \"Initializing...\")\n  (js/setInterval tick! 20)\n  (reset! state (init-state))\n  (io/init!)\n  (start))\n"]}